% Wayland: A Complete Guide to Modern Display Server Architecture
% Main document file
\documentclass[11pt,twoside,openright]{book}

% ============================================================================
% PACKAGE IMPORTS
% ============================================================================

% Font and encoding
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}

% Page layout
\usepackage[
    paperwidth=7in,
    paperheight=10in,
    top=1in,
    bottom=1in,
    inner=1in,
    outer=0.75in,
    bindingoffset=0.25in
]{geometry}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\nouppercase{\leftmark}}
\fancyhead[RO]{\nouppercase{\rightmark}}
\fancyfoot[LE,RO]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}

% Colors
\usepackage[dvipsnames,table]{xcolor}
\definecolor{codebackground}{RGB}{245,245,245}
\definecolor{codecomment}{RGB}{0,128,0}
\definecolor{codekeyword}{RGB}{0,0,255}
\definecolor{codestring}{RGB}{163,21,21}
\definecolor{linkcolor}{RGB}{0,0,139}
\definecolor{urlcolor}{RGB}{0,100,0}
\definecolor{citecolor}{RGB}{139,0,0}

% Graphics and figures
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,positioning,calc,patterns,decorations.pathreplacing,backgrounds,fit}
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
\usepackage{float}
\usepackage[labelfont=bf]{caption}
\usepackage{subcaption}

% Code listings
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{codebackground},
    commentstyle=\color{codecomment},
    keywordstyle=\color{codekeyword}\bfseries,
    stringstyle=\color{codestring},
    numbers=left,
    numberstyle=\tiny\color{gray},
    numbersep=5pt,
    frame=single,
    frameround=tttt,
    framesep=4pt,
    breaklines=true,
    breakatwhitespace=false,
    tabsize=4,
    showstringspaces=false,
    captionpos=b,
    aboveskip=1em,
    belowskip=1em
}

% Define C language style
\lstdefinestyle{cstyle}{
    language=C,
    morekeywords={uint32_t,int32_t,wl_display,wl_registry,wl_compositor,wl_surface,wl_shell,wl_seat,wl_keyboard,wl_pointer,wl_output,wl_buffer,wl_shm,wl_shm_pool,size_t,bool,struct}
}

% Define XML style for protocol files
\lstdefinestyle{xmlstyle}{
    language=XML,
    morestring=[b]",
    morestring=[s]{>}{<},
    morecomment=[s]{<?}{?>},
    stringstyle=\color{codestring},
    identifierstyle=\color{blue},
    keywordstyle=\color{cyan},
}

% Tables
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{longtable}

% Mathematics
\usepackage{amsmath,amssymb,amsthm}

% Hyperlinks
\usepackage[
    colorlinks=true,
    linkcolor=linkcolor,
    urlcolor=urlcolor,
    citecolor=citecolor,
    bookmarks=true,
    bookmarksnumbered=true,
    pdfstartview=FitH
]{hyperref}

% Bibliography
\usepackage[style=numeric,sorting=none,backend=biber]{biblatex}
\addbibresource{backmatter/references.bib}

% Index
\usepackage{makeidx}
\makeindex

% Glossary
\usepackage[acronym,toc]{glossaries}
\makeglossaries

% Additional useful packages
\usepackage{enumitem}
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}
\usepackage{footnote}
\usepackage{csquotes}
\usepackage{epigraph}

% Custom boxes for special content
\newtcolorbox{notebox}{
    colback=blue!5!white,
    colframe=blue!75!black,
    fonttitle=\bfseries,
    title=Note,
    breakable
}

\newtcolorbox{warningbox}{
    colback=orange!5!white,
    colframe=orange!75!black,
    fonttitle=\bfseries,
    title=Warning,
    breakable
}

\newtcolorbox{importantbox}{
    colback=red!5!white,
    colframe=red!75!black,
    fonttitle=\bfseries,
    title=Important,
    breakable
}

\newtcolorbox{examplebox}{
    colback=green!5!white,
    colframe=green!75!black,
    fonttitle=\bfseries,
    title=Example,
    breakable
}

\newtcolorbox{designbox}{
    colback=purple!5!white,
    colframe=purple!75!black,
    fonttitle=\bfseries,
    title=Design Decision,
    breakable
}

% Theorem environments
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{principle}{Principle}[chapter]

% Custom commands
\newcommand{\wayland}{\textsc{Wayland}}
\newcommand{\xorg}{\textsc{X11}}
\newcommand{\xserver}{\textsc{X Server}}
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\interface}[1]{\texttt{#1}}
\newcommand{\function}[1]{\texttt{#1}}
\newcommand{\protocol}[1]{\texttt{#1}}

% ============================================================================
% DOCUMENT METADATA
% ============================================================================

\title{
    {\Huge\bfseries Wayland}\\[0.5em]
    {\Large A Complete Guide to Modern Display Server Architecture}\\[1em]
    {\large Philosophy, Protocol, and Practice}
}
\author{1ay1\\
        \small\url{https://github.com/1ay1/wayland_book}}
\date{\today}

% ============================================================================
% DOCUMENT CONTENT
% ============================================================================

\begin{document}

% Front matter
\frontmatter
\include{frontmatter/titlepage}
\include{frontmatter/copyright}
\include{frontmatter/dedication}
\include{frontmatter/preface}
\include{frontmatter/acknowledgments}
\tableofcontents
\listoffigures
\listoftables
\include{frontmatter/introduction}

% Main content
\mainmatter

% PART I: THE PROBLEM SPACE
\part{Understanding the Display Server Problem}
\label{part:problem-space}
\include{chapters/part1/chapter01-what-is-display-server}
\include{chapters/part1/chapter02-history-of-x11}
\include{chapters/part1/chapter03-limitations-of-x11}

% PART II: WAYLAND PHILOSOPHY AND DESIGN
\part{The Wayland Vision}
\label{part:philosophy}
\include{chapters/part2/chapter04-wayland-philosophy}
\include{chapters/part2/chapter05-design-principles}
\include{chapters/part2/chapter06-client-server-model}
\include{chapters/part2/chapter07-security-model}

% PART III: PROTOCOL DEEP DIVE
\part{The Wayland Protocol}
\label{part:protocol}
\include{chapters/part3/chapter08-protocol-basics}
\include{chapters/part3/chapter09-core-interfaces}
\include{chapters/part3/chapter10-surface-management}
\include{chapters/part3/chapter11-buffer-management}
\include{chapters/part3/chapter12-protocol-extensions}
\include{chapters/part3/chapter13-xml-protocol-definition}

% PART IV: COMPOSITOR ARCHITECTURE
\part{Building a Compositor}
\label{part:compositor}
\include{chapters/part4/chapter14-compositor-overview}
\include{chapters/part4/chapter15-wlroots-architecture}
\include{chapters/part4/chapter16-scene-graph}
\include{chapters/part4/chapter17-output-management}
\include{chapters/part4/chapter18-window-management}

% PART V: GRAPHICS AND RENDERING
\part{Graphics Pipeline}
\label{part:graphics}
\include{chapters/part5/chapter19-rendering-fundamentals}
\include{chapters/part5/chapter20-drm-kms}
\include{chapters/part5/chapter21-egl-opengl}
\include{chapters/part5/chapter22-buffer-management}
\include{chapters/part5/chapter23-damage-tracking}

% PART VI: INPUT SYSTEM
\part{Input Handling}
\label{part:input}
\include{chapters/part6/chapter24-input-overview}
\include{chapters/part6/chapter25-seat-management}
\include{chapters/part6/chapter26-keyboard-handling}
\include{chapters/part6/chapter27-pointer-touch}

% PART VII: PRACTICAL IMPLEMENTATION
\part{Building Your Own Compositor}
\label{part:implementation}
\include{chapters/part7/chapter28-development-setup}
\include{chapters/part7/chapter29-minimal-compositor}
\include{chapters/part7/chapter30-adding-features}
\include{chapters/part7/chapter31-xwayland-integration}
\include{chapters/part7/chapter32-testing-debugging}
\include{chapters/part7/chapter33-performance-optimization}

% PART VIII: ADVANCED TOPICS
\part{Advanced Concepts}
\label{part:advanced}
\include{chapters/part8/chapter34-color-management}
\include{chapters/part8/chapter35-high-dpi}
\include{chapters/part8/chapter36-multi-gpu}
\include{chapters/part8/chapter37-accessibility}
\include{chapters/part8/chapter38-wayland-protocols}

% PART IX: REAL-WORLD CASE STUDIES
\part{Case Studies and Ecosystem}
\label{part:case-studies}
\include{chapters/part9/chapter39-gnome-mutter}
\include{chapters/part9/chapter40-kde-kwin}
\include{chapters/part9/chapter41-sway-wlroots}

% Back matter
\backmatter
\appendix
\include{backmatter/appendix-a-protocol-reference}
\include{backmatter/appendix-b-build-systems}
\include{backmatter/appendix-c-debugging-tools}
\include{backmatter/appendix-d-resources}

\printglossary[type=\acronymtype,title=Acronyms]
\printglossary[title=Glossary]

\printbibliography[heading=bibintoc,title={References}]

\printindex

\end{document}
